<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timestamps Result</title>
    <style>
        .data {
            border-collapse: collapse;
            width: 100%;
        }
        .data th, .data td {
            border: 1px solid black;
            padding: 8px;
        }
        body {
            background-image: radial-gradient(circle, #2a2094, #281e9f, #251caa, #2119b5, #1c15c0);
            height: 100vh;
            overflow: hidden;
            color: white;
            font-family: Arial, sans-serif;
            position: relative;
        }
        .gain-slider {
            width: 100%;
            appearance: none;
            height: 8px;
            background: linear-gradient(to right, #007bff 0%, #ff0000 100%);
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        .gain-slider:hover {
            opacity: 1;
        }
        .gain-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #007bff;
            cursor: pointer;
            border-radius: 50%;
        }
        .gain-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #007bff;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>

    <script>
        //TODO: Place link in table according to output from script.py
        document.querySelectorAll('audio').forEach(function(audioElement) {
            // Create an audio context
            var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            // Create a media element source
            var source = audioCtx.createMediaElementSource(audioElement);

            // Create a gain node
            var gainNode = audioCtx.createGain();

            // Connect the source to the gain node and the gain node to the audio context destination
            source.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            // Find the corresponding gain slider
            var gainSlider = document.querySelector('input[data-audio-id="' + audioElement.id + '"]');

            // Function to update the slider background
            function updateSliderBackground(slider) {
                var value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
                slider.style.background = `linear-gradient(to right, #007bff ${value}%, #ff0000 ${value}%)`;
            }

            // Initial background update
            updateSliderBackground(gainSlider);

            // Attach an input event listener to the gain slider
            gainSlider.addEventListener('input', function() {
                gainNode.gain.value = this.value;
                updateSliderBackground(this);
            });
        });
        </script>
</head>
<body>
    <h1>Timestamps of Sounds Below 1000Hz</h1>
    <div>
        <table class="data">
            <thead>
                <tr>
                    <th>Begin (s)</th>
                    <th>End (s)</th>
                    <th>Audio Clip</th>
                    <th>Gain</th>
                    <th>Correct?</th>
                    <th>Hopespot</th>
                </tr>
            </thead>
            <tbody>
                {% for index, row in tables[0].iterrows() %}
                <tr>
                    <td>{{ row['begin'] }}</td>
                    <td>{{ row['end'] }}</td>
                    <td>
                        <audio controls>
                            <source src="{{ url_for('static', filename='uploads/' ~ row['audio_clip']) }}" type="audio/wav">
                            Your browser does not support the audio element.
                        </audio>
                    </td>
                    <td>
                        <input type="range" min="1" max="10" step="0.1" value="1" id="gain-slider-{{ index }}" data-audio-id="audio-{{ index }}" class="gain-slider">
                    </td>
                    <td>
                        <button>Yes</button>
                        <button>No</button>
                    </td>
                    <td>
                        <a href="">Link to hopespot {{ location }}</a>
                    </td>
                </tr>
                {% endfor %}

                <!--
                //TODO: Add Column for is this correct or not (2 buttons) this will be used to help guide the ML model in the future 
                //TODO: Add column for link to hopespot / location of the recording , if defined 
                -->

            </tbody>
        </table>
    </div>
    <a href="{{ url_for('index') }}">Upload another file</a>
</body>
</html>
